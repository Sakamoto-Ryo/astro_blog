---
import { getEntry, getCollection } from 'astro:content';
import Layout from '../../components/Layout.astro';

// 为静态生成提供所有可能的路径
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post: { slug: string }) => ({
    params: { slug: post.slug },
  }));
}

// 从URL获取文章的slug参数
const { slug } = Astro.params;

// 尝试获取对应的博客文章
const post = await getEntry('blog', slug as string);

// 如果文章不存在，返回404页面
if (!post) {
  return new Response('Not found', { status: 404 });
}

// 获取文章的具体内容
const { Content } = await post.render();

// 提取文章的元数据
const { title, description, date, tags } = post.data;
---

<Layout title={title}>
  <article class="blog-post">
    <header>
      <h1 class="blog-title">{title}</h1>
      <div class="blog-meta">
        <time datetime={date}>{date}</time>
        {tags && tags.length > 0 && (
          <div class="blog-tags">
            {tags.map((tag: string) => (
              <span class="blog-tag">{tag}</span>
            ))}
          </div>
        )}
      </div>
    </header>
    
    {description && (
      <p class="blog-description">{description}</p>
    )}
    
    <div class="blog-content">
      <Content />
    </div>
  </article>
</Layout>

<link rel="stylesheet" href="/css/blog-post.css">